<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>CLAUDE.md • completejourney</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css"><script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet"><script src="pkgdown.js"></script><meta property="og:title" content="CLAUDE.md"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-title-body">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">completejourney</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-book"></span>

    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="articles/completejourney.html">User Guide</a>
    </li>
  </ul></li>
<li>
  <a href="reference/index.html">
    <span class="fa fa-file-code-o"></span>

    Reference
  </a>
</li>
<li>
  <a href="news/index.html">
    <span class="fa fa-newspaper-o"></span>

    News
  </a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/bradleyboehmke/completejourney" class="external-link">
    <span class="fa fa-github fa-lg"></span>

    GitHub
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="contents col-md-9">
    <div class="page-header">
      <h1>CLAUDE.md</h1>
    </div>

<div id="claudemd" class="section level1">

<p>This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.</p>
<div class="section level2">
<h2 id="package-overview">Package Overview<a class="anchor" aria-label="anchor" href="#package-overview"></a></h2>
<p>This is an R data package providing retail shopping transactions data from the 84.51° Complete Journey 2.0 study. It contains grocery store shopping data for 2,469 households over one year, including transactions, demographics, campaigns, coupons, and product metadata.</p>
</div>
<div class="section level2">
<h2 id="key-architecture">Key Architecture<a class="anchor" aria-label="anchor" href="#key-architecture"></a></h2>
<div class="section level3">
<h3 id="data-distribution-strategy">Data Distribution Strategy<a class="anchor" aria-label="anchor" href="#data-distribution-strategy"></a></h3>
<p>The package uses a hybrid approach for data distribution due to size constraints:</p>
<ol style="list-style-type: decimal"><li>
<strong>Built-in datasets</strong> (smaller data): Stored as <code>.rda</code> files in <code>data/</code> directory
<ul><li>
<code>campaigns</code>, <code>campaign_descriptions</code>, <code>coupons</code>, <code>coupon_redemptions</code>
</li>
<li>
<code>demographics</code>, <code>products</code>
</li>
<li>
<code>transactions_sample</code> (75,000 rows), <code>promotions_sample</code> (360,535 rows)</li>
</ul></li>
<li>
<strong>Remote datasets</strong> (large data): Stored as <code>.rds</code> files on GitHub, downloaded on demand
<ul><li>
<code>transactions</code> (1.47M rows) - downloaded via <code><a href="reference/get_transactions.html">get_transactions()</a></code>
</li>
<li>
<code>promotions</code> (20.9M rows) - downloaded via <code><a href="reference/get_promotions.html">get_promotions()</a></code>
</li>
<li>Both available via <code>get_data(which = 'both')</code>
</li>
</ul></li>
</ol><p>The download mechanism is implemented in <code>R/utils.R:download_data()</code> which: - Checks internet connectivity via <code><a href="https://jeroen.r-universe.dev/curl/reference/nslookup.html" class="external-link">curl::has_internet()</a></code> - Downloads from GitHub using <code>readRDS(gzcon(url(...)))</code> - Shows progress bars using the <code>progress</code> package - Returns single tibble or list of tibbles - <strong>Fails gracefully</strong>: If downloads fail (timeout, 404, network issues), displays informative message and returns NULL instead of throwing error (CRAN policy compliance)</p>
</div>
<div class="section level3">
<h3 id="data-processing-pipeline">Data Processing Pipeline<a class="anchor" aria-label="anchor" href="#data-processing-pipeline"></a></h3>
<p>The <code>data-raw/prep-data.R</code> script contains the complete data cleaning pipeline for converting raw 84.51° CSV files into package-ready data. Key transformations include:</p>
<ul><li>
<strong>Transactions</strong>: Date normalization (converting day index to real dates), creating transaction timestamps, standardizing discount fields, filtering to one-year slice (days 285-650)</li>
<li>
<strong>Demographics</strong>: Extensive factor level recoding and household composition inference logic</li>
<li>
<strong>Products</strong>: Department standardization, package size normalization, product category cleaning</li>
<li>
<strong>Promotions</strong>: Week re-indexing, conversion of display/mailer to factor levels</li>
<li>
<strong>Campaigns</strong>: Campaign ID remapping to sequential 1-27 range (see switch_id() function)</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="common-commands">Common Commands<a class="anchor" aria-label="anchor" href="#common-commands"></a></h2>
<div class="section level3">
<h3 id="package-development">Package Development<a class="anchor" aria-label="anchor" href="#package-development"></a></h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install development dependencies</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"devtools"</span>, <span class="st">"roxygen2"</span>, <span class="st">"testthat"</span>, <span class="st">"usethis"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load package during development</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate documentation from roxygen2 comments</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/document.html" class="external-link">document</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run tests</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/test.html" class="external-link">test</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check package</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/check.html" class="external-link">check</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Build package</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/build.html" class="external-link">build</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install from local source</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a></h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run all tests</span></span>
<span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_dir.html" class="external-link">test_dir</a></span><span class="op">(</span><span class="st">"tests/testthat"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run specific test file</span></span>
<span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_file.html" class="external-link">test_file</a></span><span class="op">(</span><span class="st">"tests/testthat/test_dimensions.R"</span><span class="op">)</span></span></code></pre></div>
<p>Tests are located in <code>tests/testthat/</code> and use <code>skip_on_cran()</code> and <code>skip_on_ci()</code> to avoid running dimension checks in CI environments.</p>
</div>
<div class="section level3">
<h3 id="building-documentation">Building Documentation<a class="anchor" aria-label="anchor" href="#building-documentation"></a></h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate pkgdown site</span></span>
<span><span class="fu">pkgdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgdown.r-lib.org/reference/build_site.html" class="external-link">build_site</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview vignettes</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/build_vignettes.html" class="external-link">build_vignettes</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-regeneration">Data Regeneration<a class="anchor" aria-label="anchor" href="#data-regeneration"></a></h3>
<p>To rebuild the package datasets from raw source files, run the data processing script:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"data-raw/prep-data.R"</span><span class="op">)</span></span></code></pre></div>
<p>Note: This requires the raw CSV files from 84.51° to be available at the hardcoded path <code>../../Data sets/Complete_Journey_UV_Version/</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="package-structure">Package Structure<a class="anchor" aria-label="anchor" href="#package-structure"></a></h2>
<div class="section level3">
<h3 id="r-directory-files">R/ Directory Files<a class="anchor" aria-label="anchor" href="#r-directory-files"></a></h3>
<ul><li>
<code>completejourney.R</code>: Package-level documentation</li>
<li>Individual data documentation files: <code>campaigns.R</code>, <code>coupons.R</code>, <code>demographics.R</code>, <code>products.R</code>, <code>transactions.R</code>, <code>promotions.R</code>, <code>campaign_descriptions.R</code>, <code>coupon_redemptions.R</code>
</li>
<li>
<code>get_data.R</code>: Convenience function to download both datasets</li>
<li>
<code>get_transactions.R</code>, <code>get_promotions.R</code>: Individual download functions</li>
<li>
<code>utils.R</code>: Internal helper functions (<code>download_data()</code>, <code>%notin%</code>, pipe operators)</li>
<li>
<code>zzz.R</code>: Package startup messages</li>
</ul></div>
<div class="section level3">
<h3 id="dependencies">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"></a></h3>
<ul><li>Core: <code>dplyr</code>, <code>tibble</code>, <code>curl</code>, <code>progress</code>, <code>stringr</code>, <code>zeallot</code>
</li>
<li>Suggests: <code>lubridate</code>, <code>knitr</code>, <code>rmarkdown</code>, <code>testthat</code>
</li>
</ul></div>
<div class="section level3">
<h3 id="multi-assignment-pattern">Multi-assignment Pattern<a class="anchor" aria-label="anchor" href="#multi-assignment-pattern"></a></h3>
<p>The package re-exports <code>zeallot::%&lt;-%</code> to enable unpacking multiple datasets:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">promotions</span>, <span class="va">transactions</span><span class="op">)</span> <span class="op"><a href="reference/multi-assign.html">%&lt;-%</a></span> <span class="fu"><a href="reference/get_data.html">get_data</a></span><span class="op">(</span>which <span class="op">=</span> <span class="st">'both'</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="important-conventions">Important Conventions<a class="anchor" aria-label="anchor" href="#important-conventions"></a></h2>
<div class="section level3">
<h3 id="id-variables">ID Variables<a class="anchor" aria-label="anchor" href="#id-variables"></a></h3>
<p>All ID columns (e.g., <code>household_id</code>, <code>product_id</code>, <code>store_id</code>, <code>campaign_id</code>) are stored as character strings, not integers.</p>
</div>
<div class="section level3">
<h3 id="date-handling">Date Handling<a class="anchor" aria-label="anchor" href="#date-handling"></a></h3>
<ul><li>Transaction dates use the America/New_York timezone</li>
<li>Original “day” index (285-650) is converted to real dates starting from 2017-01-01</li>
<li>Week numbers are re-indexed starting from 1 (original week_no - 40)</li>
<li>Special case: Daylight saving time on 2017-03-12 handled in timestamp creation</li>
<li>Christmas Day (2017-12-25) transactions are removed (assumed store closed)</li>
</ul></div>
<div class="section level3">
<h3 id="discount-fields">Discount Fields<a class="anchor" aria-label="anchor" href="#discount-fields"></a></h3>
<p>All discount fields (<code>retail_disc</code>, <code>coupon_disc</code>, <code>coupon_match_disc</code>) are stored as positive values. Positive retail discounts in raw data are converted to zero.</p>
</div>
<div class="section level3">
<h3 id="rbuildignore-entries">.Rbuildignore Entries<a class="anchor" aria-label="anchor" href="#rbuildignore-entries"></a></h3>
<p>The package excludes <code>data/promotions.rds</code> and <code>data/transactions.rds</code> from the built package since they’re too large for CRAN and are downloaded separately.</p>
</div>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>

</div>



      <footer><div class="copyright">
  <p></p><p>Developed by Brad Boehmke, Steven M. Mortimer.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer></div>






  </body></html>

